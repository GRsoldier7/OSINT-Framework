<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Analysis Tool - OSINT Framework</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="../css/normalize.css">
    <link rel="stylesheet" href="../css/magicui.css">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Custom styles for the AI tool */
        .tool-header {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
            padding: var(--space-8) 0;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .tool-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NiIgaGVpZ2h0PSIxMDAiPgo8cmVjdCB3aWR0aD0iNTYiIGhlaWdodD0iMTAwIiBmaWxsPSIjMDAwMCI+PC9yZWN0Pgo8cGF0aCBkPSJNMjggNjZMMCA1MEwwIDE2TDI4IDBMNTYgMTZMNTYgNTBMMjggNjZMMjggMTAwIiBmaWxsPSJub25lIiBzdHJva2U9InJnYmEoMjU1LDI1NSwyNTUsMC4xKSIgc3Ryb2tlLXdpZHRoPSIyIj48L3BhdGg+CjxwYXRoIGQ9Ik0yOCAwTDI4IDM0TDAgNTBMMCA4NEwyOCAxMDBMNTYgODRMNTYgNTBMMjggMzQiIGZpbGw9Im5vbmUiIHN0cm9rZT0icmdiYSgyNTUsMjU1LDI1NSwwLjEpIiBzdHJva2Utd2lkdGg9IjIiPjwvcGF0aD4KPC9zdmc+');
            opacity: 0.1;
        }

        .tool-header-content {
            position: relative;
            z-index: 1;
        }

        .ai-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: var(--space-2);
            margin-bottom: var(--space-6);
            border-bottom: 1px solid var(--color-border);
            padding-bottom: var(--space-2);
        }

        .ai-tab {
            padding: var(--space-2) var(--space-4);
            cursor: pointer;
            border-radius: var(--border-radius-md);
            transition: all var(--transition-fast);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .ai-tab:hover {
            background-color: var(--color-surface-accent);
        }

        .ai-tab.active {
            background-color: var(--color-primary);
            color: white;
        }

        .ai-tab-content {
            display: none;
            animation: fadeIn var(--transition-normal);
        }

        .ai-tab-content.active {
            display: block;
        }

        .ai-form {
            margin-bottom: var(--space-6);
        }

        .ai-textarea {
            width: 100%;
            padding: var(--space-3);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius-md);
            background-color: var(--color-surface);
            color: var(--color-text-primary);
            min-height: 200px;
            resize: vertical;
            font-family: var(--font-family);
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
        }

        .ai-textarea:focus {
            border-color: var(--color-primary);
            box-shadow: var(--shadow-outline);
            outline: none;
        }

        .ai-input {
            width: 100%;
            padding: var(--space-3);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius-md);
            background-color: var(--color-surface);
            color: var(--color-text-primary);
            font-family: var(--font-family);
            transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
        }

        .ai-input:focus {
            border-color: var(--color-primary);
            box-shadow: var(--shadow-outline);
            outline: none;
        }

        .ai-submit-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-2);
            padding: var(--space-3) var(--space-6);
            font-weight: 500;
        }

        .ai-result {
            margin-top: var(--space-6);
            padding: var(--space-4);
            border-radius: var(--border-radius-lg);
            background-color: var(--color-surface);
            border-left: 4px solid var(--color-primary);
            display: none;
        }

        .ai-result.show {
            display: block;
            animation: slideInUp var(--transition-normal);
        }

        .ai-result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-4);
            padding-bottom: var(--space-2);
            border-bottom: 1px solid var(--color-border);
        }

        .ai-result-title {
            font-weight: 600;
            color: var(--color-primary);
            margin: 0;
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .ai-result-actions {
            display: flex;
            gap: var(--space-2);
        }

        .ai-result-action {
            background: none;
            border: none;
            color: var(--color-text-secondary);
            cursor: pointer;
            padding: var(--space-1);
            border-radius: var(--border-radius-sm);
            transition: all var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ai-result-action:hover {
            color: var(--color-primary);
            background-color: var(--color-surface-accent);
        }

        .ai-result-content {
            max-height: 500px;
            overflow-y: auto;
            padding-right: var(--space-2);
        }

        .ai-result-content pre {
            background-color: var(--color-surface-accent);
            padding: var(--space-3);
            border-radius: var(--border-radius-md);
            overflow-x: auto;
        }

        .ai-result-content code {
            font-family: monospace;
        }

        .ai-loading {
            display: none;
            margin: var(--space-6) 0;
            text-align: center;
        }

        .ai-loading.show {
            display: block;
        }

        .ai-loading-spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 3px solid rgba(var(--color-primary-rgb), 0.3);
            border-radius: 50%;
            border-top-color: var(--color-primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .ai-loading-text {
            margin-top: var(--space-2);
            color: var(--color-text-secondary);
        }

        .entity-list {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: var(--space-4);
        }

        @media (min-width: 768px) {
            .entity-list {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .entity-category {
            background-color: var(--color-surface-accent);
            border-radius: var(--border-radius-md);
            padding: var(--space-3);
        }

        .entity-category-title {
            margin-top: 0;
            margin-bottom: var(--space-2);
            font-size: var(--font-size-lg);
            color: var(--color-primary);
            display: flex;
            align-items: center;
            gap: var(--space-2);
        }

        .entity-item {
            background-color: var(--color-surface);
            border-radius: var(--border-radius-sm);
            padding: var(--space-2);
            margin-bottom: var(--space-2);
        }

        .entity-name {
            font-weight: 600;
        }

        .entity-context {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin-top: var(--space-1);
        }

        .search-query-list {
            list-style: none;
            padding: 0;
        }

        .search-query-item {
            display: flex;
            align-items: center;
            padding: var(--space-2);
            border-radius: var(--border-radius-md);
            margin-bottom: var(--space-2);
            background-color: var(--color-surface-accent);
        }

        .search-query-icon {
            margin-right: var(--space-2);
            color: var(--color-primary);
        }

        .search-query-text {
            flex-grow: 1;
            font-family: monospace;
        }

        .search-query-use {
            background: none;
            border: none;
            color: var(--color-primary);
            cursor: pointer;
            padding: var(--space-1) var(--space-2);
            border-radius: var(--border-radius-sm);
            transition: background-color var(--transition-fast);
        }

        .search-query-use:hover {
            background-color: var(--color-surface);
        }

        .back-button {
            display: inline-flex;
            align-items: center;
            gap: var(--space-2);
            color: var(--color-text-primary);
            text-decoration: none;
            padding: var(--space-2) var(--space-4);
            border-radius: var(--border-radius-md);
            transition: background-color var(--transition-fast);
            margin-bottom: var(--space-4);
        }

        .back-button:hover {
            background-color: var(--color-surface-accent);
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container navbar-container">
            <a href="../index.html" class="navbar-brand">
                <i class="fas fa-search-location"></i> OSINT Framework
            </a>

            <ul class="navbar-nav">
                <li class="nav-item"><a href="../index.html#tools" class="nav-link">Tools</a></li>
                <li class="nav-item"><a href="../index.html#features" class="nav-link">Features</a></li>
                <li class="nav-item"><a href="https://github.com/GRsoldier7/OSINT-Framework" target="_blank" class="nav-link">GitHub</a></li>
            </ul>

            <div class="theme-toggle-wrapper">
                <span class="theme-toggle-icon"><i class="fas fa-sun"></i></span>
                <label class="theme-toggle">
                    <input type="checkbox" id="theme-toggle">
                    <span class="theme-toggle-slider"></span>
                </label>
                <span class="theme-toggle-icon"><i class="fas fa-moon"></i></span>
            </div>
        </div>
    </nav>

    <!-- Tool Header -->
    <header class="tool-header">
        <div class="container tool-header-content text-center">
            <h1 data-animate="fade-in">AI Analysis Tool</h1>
            <p data-animate="slide-in">Leverage AI to analyze data, generate insights, and assist with OSINT investigations</p>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mt-6">
        <a href="../index.html" class="back-button">
            <i class="fas fa-arrow-left"></i> Back to Home
        </a>

        <div class="card" data-animate="slide-in">
            <h2>AI-Powered OSINT Analysis</h2>
            <p>This tool uses advanced AI capabilities to help with your OSINT investigations. Select a capability and enter the relevant information to get AI-generated insights.</p>

            <div class="ai-tabs">
                <div class="ai-tab active" data-tab="entity-extraction">
                    <i class="fas fa-user-tag"></i> Entity Extraction
                </div>
                <div class="ai-tab" data-tab="search-queries">
                    <i class="fas fa-search"></i> Search Queries
                </div>
                <div class="ai-tab" data-tab="report-generation">
                    <i class="fas fa-file-alt"></i> Report Generation
                </div>
                <div class="ai-tab" data-tab="image-analysis">
                    <i class="fas fa-image"></i> Image Analysis
                </div>
            </div>

            <div class="ai-tab-content active" id="entity-extraction">
                <h3>Entity Extraction</h3>
                <p>Extract entities (people, organizations, locations, etc.) from text. This helps identify key information in large amounts of data.</p>

                <form id="entityExtractionForm" class="ai-form">
                    <div class="form-group">
                        <label class="form-label" for="entityText">Text to Analyze:</label>
                        <textarea id="entityText" class="ai-textarea" placeholder="Enter text to extract entities from (news articles, reports, social media posts, etc.)..." required></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary ai-submit-button">
                        <i class="fas fa-user-tag"></i> Extract Entities
                    </button>
                </form>

                <div class="ai-loading" id="entityLoading">
                    <div class="ai-loading-spinner"></div>
                    <div class="ai-loading-text">Analyzing text and extracting entities...</div>
                </div>

                <div class="ai-result" id="entityResult">
                    <div class="ai-result-header">
                        <h3 class="ai-result-title">
                            <i class="fas fa-user-tag"></i> Extracted Entities
                        </h3>
                        <div class="ai-result-actions">
                            <button class="ai-result-action" id="entityCopyButton" title="Copy to clipboard">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="ai-result-action" id="entityCloseButton" title="Close">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="ai-result-content" id="entityResultContent">
                        <!-- Entity results will be displayed here -->
                    </div>
                </div>
            </div>

            <div class="ai-tab-content" id="search-queries">
                <h3>Search Query Generation</h3>
                <p>Generate effective search queries for OSINT research. This helps you find more relevant information by using advanced search techniques.</p>

                <form id="searchQueryForm" class="ai-form">
                    <div class="form-group">
                        <label class="form-label" for="searchTopic">Research Topic:</label>
                        <input type="text" id="searchTopic" class="ai-input" placeholder="Enter a research topic (e.g., 'John Smith cybersecurity expert')..." required>
                    </div>

                    <button type="submit" class="btn btn-primary ai-submit-button">
                        <i class="fas fa-search"></i> Generate Search Queries
                    </button>
                </form>

                <div class="ai-loading" id="queryLoading">
                    <div class="ai-loading-spinner"></div>
                    <div class="ai-loading-text">Generating optimized search queries...</div>
                </div>

                <div class="ai-result" id="queryResult">
                    <div class="ai-result-header">
                        <h3 class="ai-result-title">
                            <i class="fas fa-search"></i> Generated Search Queries
                        </h3>
                        <div class="ai-result-actions">
                            <button class="ai-result-action" id="queryCopyButton" title="Copy to clipboard">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="ai-result-action" id="queryCloseButton" title="Close">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="ai-result-content" id="queryResultContent">
                        <!-- Search query results will be displayed here -->
                    </div>
                </div>
            </div>

            <div class="ai-tab-content" id="report-generation">
                <h3>Report Generation</h3>
                <p>Generate a comprehensive OSINT report based on your findings. This helps organize and present your investigation results in a professional format.</p>

                <form id="reportForm" class="ai-form">
                    <div class="form-group">
                        <label class="form-label" for="reportData">Investigation Findings:</label>
                        <textarea id="reportData" class="ai-textarea" placeholder="Enter your investigation findings (raw data, observations, links, etc.)..." required></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary ai-submit-button">
                        <i class="fas fa-file-alt"></i> Generate Report
                    </button>
                </form>

                <div class="ai-loading" id="reportLoading">
                    <div class="ai-loading-spinner"></div>
                    <div class="ai-loading-text">Generating comprehensive report...</div>
                </div>

                <div class="ai-result" id="reportResult">
                    <div class="ai-result-header">
                        <h3 class="ai-result-title">
                            <i class="fas fa-file-alt"></i> Generated Report
                        </h3>
                        <div class="ai-result-actions">
                            <button class="ai-result-action" id="reportCopyButton" title="Copy to clipboard">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="ai-result-action" id="reportCloseButton" title="Close">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="ai-result-content" id="reportResultContent">
                        <!-- Report results will be displayed here -->
                    </div>
                </div>
            </div>

            <div class="ai-tab-content" id="image-analysis">
                <h3>Image Analysis</h3>
                <p>Analyze images for OSINT purposes. This helps identify key elements in images that might provide valuable intelligence.</p>

                <form id="imageAnalysisForm" class="ai-form">
                    <div class="form-group">
                        <label class="form-label" for="imageUrl">Image URL:</label>
                        <input type="text" id="imageUrl" class="ai-input" placeholder="Enter an image URL (e.g., https://example.com/image.jpg)..." required>
                    </div>

                    <button type="submit" class="btn btn-primary ai-submit-button">
                        <i class="fas fa-image"></i> Analyze Image
                    </button>
                </form>

                <div class="ai-loading" id="imageLoading">
                    <div class="ai-loading-spinner"></div>
                    <div class="ai-loading-text">Analyzing image content...</div>
                </div>

                <div class="ai-result" id="imageResult">
                    <div class="ai-result-header">
                        <h3 class="ai-result-title">
                            <i class="fas fa-image"></i> Image Analysis Results
                        </h3>
                        <div class="ai-result-actions">
                            <button class="ai-result-action" id="imageCopyButton" title="Copy to clipboard">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="ai-result-action" id="imageCloseButton" title="Close">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    <div class="ai-result-content" id="imageResultContent">
                        <!-- Image analysis results will be displayed here -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-links">
                <a href="../index.html" class="footer-link">Home</a>
                <a href="../index.html#tools" class="footer-link">Tools</a>
                <a href="../index.html#features" class="footer-link">Features</a>
                <a href="https://github.com/GRsoldier7/OSINT-Framework" target="_blank" class="footer-link">GitHub</a>
                <a href="#" class="footer-link">Privacy Policy</a>
                <a href="#" class="footer-link">Terms of Use</a>
            </div>

            <div class="copyright">
                <p>&copy; 2024 Ultimate OSINT Framework. All Rights Reserved.</p>
                <p class="mt-2">For legitimate OSINT research and educational purposes only.</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="../js/magicui.js"></script>
    <script src="../js/ai-service.js"></script>
    <script>
        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            console.log('AI Tool initialized');
            initTabs();
            initEntityExtraction();
            initSearchQueries();
            initReportGeneration();
            initImageAnalysis();
        });

        /**
         * Initialize tabs
         */
        function initTabs() {
            document.querySelectorAll('.ai-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs and tab contents
                    document.querySelectorAll('.ai-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.ai-tab-content').forEach(c => c.classList.remove('active'));

                    // Add active class to clicked tab
                    this.classList.add('active');

                    // Show corresponding tab content
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
        }

        /**
         * Initialize entity extraction
         */
        function initEntityExtraction() {
            const form = document.getElementById('entityExtractionForm');
            const loading = document.getElementById('entityLoading');
            const result = document.getElementById('entityResult');
            const resultContent = document.getElementById('entityResultContent');
            const copyButton = document.getElementById('entityCopyButton');
            const closeButton = document.getElementById('entityCloseButton');

            form.addEventListener('submit', async function(e) {
                e.preventDefault();

                const text = document.getElementById('entityText').value;

                if (!text) {
                    if (window.MagicUI && window.MagicUI.notify) {
                        window.MagicUI.notify.error('Please enter text to analyze.');
                    } else {
                        alert('Please enter text to analyze.');
                    }
                    return;
                }

                // Show loading
                loading.classList.add('show');
                result.classList.remove('show');

                try {
                    // Call the AI service
                    const entities = await window.AI_SERVICE.extractEntities(text);

                    // Hide loading
                    loading.classList.remove('show');

                    // Display results
                    displayEntities(entities);

                    // Show result
                    result.classList.add('show');

                    // Show success notification
                    if (window.MagicUI && window.MagicUI.notify) {
                        window.MagicUI.notify.success('Entities extracted successfully!');
                    }
                } catch (error) {
                    console.error('Error extracting entities:', error);

                    // Hide loading
                    loading.classList.remove('show');

                    // Show error notification
                    if (window.MagicUI && window.MagicUI.notify) {
                        window.MagicUI.notify.error('Error extracting entities. Please try again.');
                    } else {
                        alert('Error extracting entities. Please try again.');
                    }
                }
            });

            // Copy button
            copyButton.addEventListener('click', function() {
                const content = resultContent.innerText;
                navigator.clipboard.writeText(content).then(() => {
                    if (window.MagicUI && window.MagicUI.notify) {
                        window.MagicUI.notify.success('Copied to clipboard!');
                    } else {
                        alert('Copied to clipboard!');
                    }
                });
            });

            // Close button
            closeButton.addEventListener('click', function() {
                result.classList.remove('show');
            });

            /**
             * Display entities in the result container
             * @param {Object} entities - Extracted entities
             */
            function displayEntities(entities) {
                if (entities.error) {
                    resultContent.innerHTML = `
                        <div class="alert alert-error">
                            <p>Error parsing entity results. Raw response:</p>
                            <pre>${entities.rawResponse}</pre>
                        </div>
                    `;
                    return;
                }

                let html = '<div class="entity-list">';

                // Entity categories and their icons
                const categories = {
                    people: { icon: 'fa-user', title: 'People' },
                    organizations: { icon: 'fa-building', title: 'Organizations' },
                    locations: { icon: 'fa-map-marker-alt', title: 'Locations' },
                    dates: { icon: 'fa-calendar', title: 'Dates' },
                    emails: { icon: 'fa-envelope', title: 'Emails' },
                    phones: { icon: 'fa-phone', title: 'Phone Numbers' },
                    urls: { icon: 'fa-link', title: 'URLs' },
                    miscellaneous: { icon: 'fa-tag', title: 'Miscellaneous' }
                };

                // Add each category that has entities
                for (const [category, items] of Object.entries(entities)) {
                    if (Array.isArray(items) && items.length > 0) {
                        const categoryInfo = categories[category] || { icon: 'fa-tag', title: category.charAt(0).toUpperCase() + category.slice(1) };

                        html += `
                            <div class="entity-category">
                                <h4 class="entity-category-title">
                                    <i class="fas ${categoryInfo.icon}"></i> ${categoryInfo.title}
                                </h4>
                        `;

                        items.forEach(item => {
                            if (category === 'people') {
                                html += `
                                    <div class="entity-item">
                                        <div class="entity-name">${item.name}</div>
                                        ${item.context ? `<div class="entity-context">${item.context}</div>` : ''}
                                    </div>
                                `;
                            } else if (category === 'organizations') {
                                html += `
                                    <div class="entity-item">
                                        <div class="entity-name">${item.name}</div>
                                        ${item.context ? `<div class="entity-context">${item.context}</div>` : ''}
                                    </div>
                                `;
                            } else if (category === 'locations') {
                                html += `
                                    <div class="entity-item">
                                        <div class="entity-name">${item.name}</div>
                                        ${item.context ? `<div class="entity-context">${item.context}</div>` : ''}
                                    </div>
                                `;
                            } else if (category === 'dates') {
                                html += `
                                    <div class="entity-item">
                                        <div class="entity-name">${item.date}</div>
                                        ${item.context ? `<div class="entity-context">${item.context}</div>` : ''}
                                    </div>
                                `;
                            } else if (category === 'emails') {
                                html += `
                                    <div class="entity-item">
                                        <div class="entity-name">${item.email}</div>
                                        ${item.context ? `<div class="entity-context">${item.context}</div>` : ''}
                                    </div>
                                `;
                            } else if (category === 'phones') {
                                html += `
                                    <div class="entity-item">
                                        <div class="entity-name">${item.phone}</div>
                                        ${item.context ? `<div class="entity-context">${item.context}</div>` : ''}
                                    </div>
                                `;
                            } else if (category === 'urls') {
                                html += `
                                    <div class="entity-item">
                                        <div class="entity-name">${item.url}</div>
                                        ${item.context ? `<div class="entity-context">${item.context}</div>` : ''}
                                    </div>
                                `;
                            } else {
                                html += `
                                    <div class="entity-item">
                                        <div class="entity-name">${item.entity || JSON.stringify(item)}</div>
                                        ${item.context ? `<div class="entity-context">${item.context}</div>` : ''}
                                    </div>
                                `;
                            }
                        });

                        html += '</div>';
                    }
                }

                html += '</div>';

                resultContent.innerHTML = html;
            }
        }

        /**
         * Initialize search queries
         */
        function initSearchQueries() {
            const form = document.getElementById('searchQueryForm');
            const loading = document.getElementById('queryLoading');
            const result = document.getElementById('queryResult');
            const resultContent = document.getElementById('queryResultContent');
            const copyButton = document.getElementById('queryCopyButton');
            const closeButton = document.getElementById('queryCloseButton');

            form.addEventListener('submit', async function(e) {
                e.preventDefault();

                const topic = document.getElementById('searchTopic').value;

                if (!topic) {
                    if (window.MagicUI && window.MagicUI.notify) {
                        window.MagicUI.notify.error('Please enter a research topic.');
                    } else {
                        alert('Please enter a research topic.');
                    }
                    return;
                }

                // Show loading
                loading.classList.add('show');
                result.classList.remove('show');

                try {
                    // Call the AI service
                    const queries = await window.AI_SERVICE.generateSearchQueries(topic);

                    // Hide loading
                    loading.classList.remove('show');

                    // Display results
                    displaySearchQueries(queries);

                    // Show result
                    result.classList.add('show');

                    // Show success notification
                    if (window.MagicUI && window.MagicUI.notify) {
                        window.MagicUI.notify.success('Search queries generated successfully!');
                    }
                } catch (error) {
                    console.error('Error generating search queries:', error);

                    // Hide loading
                    loading.classList.remove('show');

                    // Show error notification
                    if (window.MagicUI && window.MagicUI.notify) {
                        window.MagicUI.notify.error('Error generating search queries. Please try again.');
                    } else {
                        alert('Error generating search queries. Please try again.');
                    }
                }
            });

            // Copy button
            copyButton.addEventListener('click', function() {
                const content = resultContent.innerText;
                navigator.clipboard.writeText(content).then(() => {
                    if (window.MagicUI && window.MagicUI.notify) {
                        window.MagicUI.notify.success('Copied to clipboard!');
                    } else {
                        alert('Copied to clipboard!');
                    }
                });
            });

            // Close button
            closeButton.addEventListener('click', function() {
                result.classList.remove('show');
            });

            /**
             * Display search queries in the result container
             * @param {string[]} queries - Generated search queries
             */
            function displaySearchQueries(queries) {
                if (!queries || queries.length === 0) {
                    resultContent.innerHTML = `
                        <div class="alert alert-error">
                            <p>No search queries generated.</p>
                        </div>
                    `;
                    return;
                }

                let html = '<ul class="search-query-list">';

                queries.forEach(query => {
                    html += `
                        <li class="search-query-item">
                            <i class="fas fa-search search-query-icon"></i>
                            <span class="search-query-text">${query}</span>
                            <button class="search-query-use" data-query="${query}">Use</button>
                        </li>
                    `;
                });

                html += '</ul>';

                resultContent.innerHTML = html;

                // Add event listeners to "Use" buttons
                document.querySelectorAll('.search-query-use').forEach(button => {
                    button.addEventListener('click', function() {
                        const query = this.getAttribute('data-query');

                        // Open Google search in a new tab
                        window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');

                        // Show notification
                        if (window.MagicUI && window.MagicUI.notify) {
                            window.MagicUI.notify.info(`Searching for: "${query}"`);
                        }
                    });
                });
            }
        }

        /**
         * Initialize report generation
         */
        function initReportGeneration() {
            const form = document.getElementById('reportForm');
            const loading = document.getElementById('reportLoading');
            const result = document.getElementById('reportResult');
            const resultContent = document.getElementById('reportResultContent');
            const copyButton = document.getElementById('reportCopyButton');
            const closeButton = document.getElementById('reportCloseButton');

            form.addEventListener('submit', async function(e) {
                e.preventDefault();

                const findings = document.getElementById('reportData').value;

                if (!findings) {
                    if (window.MagicUI && window.MagicUI.notify) {
                        window.MagicUI.notify.error('Please enter investigation findings.');
                    } else {
                        alert('Please enter investigation findings.');
                    }
                    return;
                }

                // Show loading
                loading.classList.add('show');
                result.classList.remove('show');

                try {
                    // Call the AI service
                    const report = await window.AI_SERVICE.generateReport(findings);

                    // Hide loading
                    loading.classList.remove('show');

                    // Display results
                    resultContent.innerHTML = `<div class="markdown-content">${report}</div>`;

                    // Show result
                    result.classList.add('show');

                    // Show success notification
                    if (window.MagicUI && window.MagicUI.notify) {
                        window.MagicUI.notify.success('Report generated successfully!');
                    }
                } catch (error) {
                    console.error('Error generating report:', error);

                    // Hide loading
                    loading.classList.remove('show');

                    // Show error notification
                    if (window.MagicUI && window.MagicUI.notify) {
                        window.MagicUI.notify.error('Error generating report. Please try again.');
                    } else {
                        alert('Error generating report. Please try again.');
                    }
                }
            });

            // Copy button
            copyButton.addEventListener('click', function() {
                const content = resultContent.innerText;
                navigator.clipboard.writeText(content).then(() => {
                    if (window.MagicUI && window.MagicUI.notify) {
                        window.MagicUI.notify.success('Copied to clipboard!');
                    } else {
                        alert('Copied to clipboard!');
                    }
                });
            });

            // Close button
            closeButton.addEventListener('click', function() {
                result.classList.remove('show');
            });
        }

        /**
         * Initialize image analysis
         */
        function initImageAnalysis() {
            const form = document.getElementById('imageAnalysisForm');
            const loading = document.getElementById('imageLoading');
            const result = document.getElementById('imageResult');
            const resultContent = document.getElementById('imageResultContent');
            const copyButton = document.getElementById('imageCopyButton');
            const closeButton = document.getElementById('imageCloseButton');

            form.addEventListener('submit', async function(e) {
                e.preventDefault();

                const imageUrl = document.getElementById('imageUrl').value;

                if (!imageUrl) {
                    if (window.MagicUI && window.MagicUI.notify) {
                        window.MagicUI.notify.error('Please enter an image URL.');
                    } else {
                        alert('Please enter an image URL.');
                    }
                    return;
                }

                // Show loading
                loading.classList.add('show');
                result.classList.remove('show');

                try {
                    // Call the AI service
                    const analysis = await window.AI_SERVICE.analyzeImage(imageUrl);

                    // Hide loading
                    loading.classList.remove('show');

                    // Display results
                    resultContent.innerHTML = `
                        <div class="image-preview">
                            <img src="${imageUrl}" alt="Analyzed image" style="max-width: 100%; max-height: 300px; margin-bottom: 20px;">
                        </div>
                        <div class="markdown-content">${analysis}</div>
                    `;

                    // Show result
                    result.classList.add('show');

                    // Show success notification
                    if (window.MagicUI && window.MagicUI.notify) {
                        window.MagicUI.notify.success('Image analyzed successfully!');
                    }
                } catch (error) {
                    console.error('Error analyzing image:', error);

                    // Hide loading
                    loading.classList.remove('show');

                    // Show error notification
                    if (window.MagicUI && window.MagicUI.notify) {
                        window.MagicUI.notify.error('Error analyzing image. Please try again.');
                    } else {
                        alert('Error analyzing image. Please try again.');
                    }
                }
            });

            // Copy button
            copyButton.addEventListener('click', function() {
                const content = resultContent.querySelector('.markdown-content').innerText;
                navigator.clipboard.writeText(content).then(() => {
                    if (window.MagicUI && window.MagicUI.notify) {
                        window.MagicUI.notify.success('Copied to clipboard!');
                    } else {
                        alert('Copied to clipboard!');
                    }
                });
            });

            // Close button
            closeButton.addEventListener('click', function() {
                result.classList.remove('show');
            });
        }
    </script>
</body>
</html>
